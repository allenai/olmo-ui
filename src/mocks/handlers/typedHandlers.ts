import { createOpenApiHttp } from 'openapi-msw';

import type { Model } from '@/api/playgroundApi/additionalTypes';
import type { paths, SchemaResponseModel } from '@/api/playgroundApi/playgroundApiSchema';

const http = createOpenApiHttp<paths>({
    baseUrl: process.env.LLMX_API_URL,
});

const fakeModelsResponse = [
    {
        description: "AI2's 7B model trained on the Dolma dataset and fine-tuned for chat.",
        id: 'olmo-7b-chat',
        model_type: 'chat',
        host: 'modal',
        name: 'OLMo 7B - Chat',
        is_deprecated: true,
        family_id: 'olmo',
        family_name: 'OLMo',
        is_visible: false,
        prompt_type: 'text_only',
        internal: false,
    },
    {
        description: 'A 70B parameter model that is a fine-tuned version of Llama 2.',
        id: 'tulu2',
        model_type: 'chat',
        host: 'inferd',
        name: 'Tulu2.5',
        is_deprecated: false,
        family_id: 'tulu',
        family_name: 'Tülu',
        is_visible: true,
        prompt_type: 'text_only',
        internal: false,
    },
    {
        description: "AI2's 7B model following the 'peteish' thread of improvements.",
        host: 'modal',
        id: 'OLMo-peteish-dpo-preview',
        is_deprecated: false,
        model_type: 'chat',
        name: 'OLMo-peteish-dpo-preview',
        is_visible: true,
        prompt_type: 'text_only',
        internal: false,
    },
    {
        description: 'Molmo',
        id: 'molmo',
        model_type: 'chat',
        host: 'inferd',
        name: 'Molmo',
        is_deprecated: false,
        accepts_files: true,
        accepted_file_types: ['image/*'],
        is_visible: true,
        prompt_type: 'multi_modal',
        internal: false,
    },
] satisfies Array<Model>;

const fakeAdminModelsResponse = [
    {
        availableTime: null,
        createdTime: '2025-04-29T17:03:50.726370+00:00',
        defaultSystemPrompt: null,
        deprecationTime: null,
        description: 'description',
        familyId: null,
        familyName: null,
        host: 'modal',
        id: 'new-test-model',
        internal: true,
        modelIdOnHost: 'foo',
        modelType: 'chat',
        name: 'new-test-model',
        order: 0,
        promptType: 'text_only',
        updatedTime: '2025-05-07T22:40:01.919975+00:00',
        availability: 'public',
    },
    {
        availableTime: null,
        createdTime: '2025-04-25T18:16:49.831683+00:00',
        defaultSystemPrompt: null,
        deprecationTime: null,
        description: 'A 405B parameter model that is a fine-tuned version of Llama 2.',
        familyId: 'tulu',
        familyName: 'Tülu',
        host: 'inferd',
        id: 'tulu3-405b',
        internal: true,
        modelIdOnHost: 'csc_01jjqp4s2x3hq6e05j3a0h3f96',
        modelType: 'chat',
        name: 'Llama Tülu 3 405B-test2',
        order: 1,
        promptType: 'text_only',
        updatedTime: '2025-05-07T22:40:01.919975+00:00',
        availability: 'public',
    },
    {
        availableTime: null,
        createdTime: '2025-04-25T20:25:13.122286+00:00',
        defaultSystemPrompt: null,
        deprecationTime: null,
        description: 'foo',
        familyId: 'tulu',
        familyName: 'Tülu',
        host: 'inferd',
        id: 'test-model-5',
        internal: true,
        modelIdOnHost: 'csc_01jjqp4s2x3hq6e05j3a0h3f96',
        modelType: 'chat',
        name: 'Llama Tülu 3 405B-test22',
        order: 2,
        promptType: 'text_only',
        updatedTime: '2025-05-07T22:40:01.919975+00:00',
        availability: 'public',
    },
    {
        availableTime: null,
        createdTime: '2025-04-29T17:04:22.850975+00:00',
        defaultSystemPrompt: null,
        deprecationTime: null,
        description: 'description',
        familyId: null,
        familyName: null,
        host: 'modal',
        id: 'new-test-model-2',
        internal: true,
        modelIdOnHost: 'foo',
        modelType: 'chat',
        name: 'new-test-model-2',
        order: 3,
        promptType: 'text_only',
        updatedTime: '2025-05-07T22:40:01.919975+00:00',
        availability: 'public',
    },
    {
        acceptedFileTypes: ['image/*', 'application/pdf'],
        allowFilesInFollowups: null,
        availableTime: '2025-04-27T02:41:42+00:00',
        createdTime: '2025-04-29T20:00:26.072706+00:00',
        defaultSystemPrompt: null,
        deprecationTime: null,
        description: 'This model is made for testing',
        familyId: null,
        familyName: null,
        host: 'inferd',
        id: 'test-multi-modal-model-16',
        internal: false,
        maxFilesPerMessage: null,
        maxTotalFileSize: null,
        modelIdOnHost: 'test-multi-modal-model-id',
        modelType: 'chat',
        name: 'model made for testing',
        order: 6,
        promptType: 'multi_modal',
        requireFileToPrompt: null,
        updatedTime: '2025-05-07T22:40:01.919975+00:00',
        availability: 'public',
    },
] satisfies SchemaResponseModel[];

const v4ModelsHandler = http.get('/v4/models/', ({ query, response }) => {
    if (query.get('admin') === 'true') {
        return response(200).json(fakeAdminModelsResponse);
    }

    console.log('handling mocked models');
    return response(200).json(fakeModelsResponse);
});

export const typedHandlers = [v4ModelsHandler];
